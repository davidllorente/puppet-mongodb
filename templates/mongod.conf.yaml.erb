# !!! generated by puppet !!!
# mongod.conf - YAML Syntax

systemLog:
   destination: file
   path: <%= scope.lookupvar('mongodb::logdir') %>/mongod_<%= @mongod_instance %>.log
   logAppend: <%= @mongod_logappend %>

processManagement:
   fork: <%= @mongod_fork %>
   pidFilePath: <%= scope.lookupvar('mongodb::dbdir') %>/mongod_<%= @mongod_instance %>/mongod.pid

net:
   port: <%= @mongod_port %>
<%- if @mongod_bind_ip != "" -%>
   bindIp: <%= @mongod_bind_ip %>
<%- end -%>

security:
<%- if @mongod_useauth != false -%>
   keyFile: /etc/mongod_<%= @mongod_instance %>.key
   clusterAuthMode: keyFile
   authorization: enabled
<% else -%>
   authorization: disabled
<%- end -%>

storage:
   dbPath: <%= scope.lookupvar('mongodb::dbdir') %>/mongod_<%= @mongod_instance %>
<%- if @mongod_oplogMinRetentionHours != "" -%>
   oplogMinRetentionHours: <%= @mongod_oplogMinRetentionHours %>
<%- end -%>
   engine: <%= @mongod_engine %>
<%- if @mongod_engine == "wiredTiger" and @mongod_cacheSizeGB != "" -%>
   wiredTiger:
      engineConfig:
         cacheSizeGB: <%= @mongod_cacheSizeGB %>
<%- end -%>

<%- if @mongod_replSet != "" -%>
replication:
   replSetName: <%= @mongod_replSet %>
<%- if @mongod_oplogSizeMB != "" -%>
   oplogSizeMB: <%= @mongod_oplogSizeMB %>
<%- end -%>
<%- end -%>

<%- if @mongod_shardsvr == true -%>
sharding:
   clusterRole: shardsvr
<%- elsif @mongod_configsvr == true -%>
sharding:
   clusterRole: configsvr
<%- end -%>

<%- if @mongod_operation_profiling_slowms != "" or @mongod_operation_profiling_mode != "" -%>
operationProfiling:
<%- if @mongod_operation_profiling_slowms != "" -%>
   slowOpThresholdMs: <%= @mongod_operation_profiling_slowms %>
<%- end -%>
<%- if @mongod_operation_profiling_mode != "" -%>
   mode: <%= @mongod_operation_profiling_mode %>
<%- end -%>
<%- end -%>

<%- if !@mongod_add_options.empty? -%>
setParameter:
<%- @mongod_add_options.sort_by{|key, value| key}.each do |key,value| -%>
  <%= key %>: <%= value %>
<%- end -%>
<%- end -%>

